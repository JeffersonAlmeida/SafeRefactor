<project name="RefactoringProject" default="run" basedir=".">
	<path id="cobertura.classpath">
		<fileset dir=".">
			<include name="saferefactor.jar" />
		</fileset>
	</path>

	<path id="classpath">
		<fileset dir="." includes="saferefactor.jar" />
	</path>

	<path id="cp">
		<fileset dir="${project.dir}/lib/" includes="**/*.jar" />
	</path>

	<path id="classpath_source">
		<fileset dir="${source}/" includes="${lib}/*.jar" />
		<fileset dir="${target}/" includes="${lib}/*.jar" />
	</path>

	<target name="init">
		<mkdir dir="" />
	</target>

	<target name="clean">
		<delete includeemptydirs="true">
			<fileset dir="${source}/bin" includes="**/*" />
			<fileset dir="${target}/bin" includes="**/*" />
			<fileset dir="${junit.output}" includes="**/*" />
			<fileset dir="${randoop.source}" includes="**/*" />
			<fileset file="${method.list.file}"/>
		</delete>
	</target>

	<target name="compile_source_and_target" depends="clean">
            <echo>* Compile Source Product</echo>
            <javac fork="yes" includes="**/*.java" debug="on" srcdir="${source}/src" destdir="${source}/bin">
                    <classpath>
                        <fileset dir="/home/jefferson/Desktop/workspace/Bank1.0/src">
                            <include name="**/*.java" />
                            <exclude name="**/Randoop*.java" />
                        </fileset>
                        <pathelement location="saferefactor.jar" />
                        <pathelement path="${java.class.path}" />
                        <pathelement path="${project.dir}/lib/junit-4.5.jar" />
                        <pathelement location="${source}/bin" />
                        <pathelement location="${source}/src" />
                    </classpath>
                    <classpath refid="classpath_source" />
            </javac>
            <echo>* Compile Target Product</echo>
            <javac fork="yes" includes="**/*.java" debug="on" srcdir="${target}/src" destdir="${target}/bin">
                    <classpath>
                        <fileset dir="${target}/src">
                            <include name="**/*.java" />
                        </fileset>
                        <pathelement location="saferefactor.jar" />
                        <pathelement path="${java.class.path}" />
                        <pathelement path="${project.dir}/lib/junit-4.5.jar" />
                        <pathelement location="${target}/${bin}" />
                        <pathelement location="${target}/src" />
                    </classpath>
                    <classpath refid="classpath_source" />
            </javac>
	</target>

	 <target name="randoop"  depends="compile_source_and_target">
		<echo>* Generate Tests With Randoop Tool</echo>
		<echo>* https://code.google.com/p/randoop/</echo>
		<java classpath="${project.dir}/lib/" classname="randoop.main.Main" fork="true" dir="${project.dir}/lib/">
             <arg value="gentests"/>
             <arg value="--methodlist=${method.list.file}"/>
             <arg value="--timelimit=${time.limit}"/>
             <arg value="--log=${source}/${log.file.name}"/>
             <arg value="--junit-output-dir=${output.dir}"/>
             <arg value="--junit-package-name=${junit.package}"/>
             <arg value="--output-nonexec=true"/>
             <arg value="--inputlimit=${input.limit}"/>
             <arg value="--remove-subsequences=false"/>
			<classpath>
				<pathelement location="saferefactor.jar" />
				<pathelement path="${java.class.path}" />
				<pathelement path="${project.dir}/bin" />
				<pathelement path="${source}/${bin}" />
			</classpath>
			<classpath refid="classpath_source" />
			<classpath refid="cp" />
		</java>
	</target>

    <target name="compile" depends="randoop">
		<echo>* Compiling the tests</echo>
		<javac fork="yes" memorymaximumsize="512m" includes="**/*.java" debug="on" srcdir="${randoop.test.dir}" destdir="${randoop.test.bin}">
			 <classpath>
				<fileset dir="${source}/${lib}">
					<include name="**/*.jar" />
				</fileset>
				<fileset dir="${randoop.test.dir}/randoop/tests">
					<include name="*.java" />
				</fileset>
				<pathelement location="saferefactor.jar" />
				<pathelement path="${java.class.path}" />
				<pathelement path="${project.dir}/lib/junit-4.5.jar" />
				<pathelement location="${source}/${bin}" />
			</classpath>
			<classpath refid="classpath_source" />
		</javac>
	</target>

	<target name="run" depends="compile">
		<echo>* Run Junit</echo>
		<junit printsummary="yes" showoutput="no" haltonfailure="yes" fork="true" maxmemory="1024m" tempdir="${temp.dir}">
			<classpath>
				<pathelement path="/home/jefferson/workspace/saferefactoraj/lib/junit-4.5.jar" />
				<pathelement path="/home/jefferson/workspace/saferefactoraj/lib/ant.jar" />
				<pathelement path="/home/jefferson/workspace/saferefactoraj/lib/ant-junit.jar" />
				<pathelement path="/home/jefferson/workspace/saferefactoraj/lib/ant-launcher.jar" />
				<fileset dir="${source}/${lib}">
					<include name="**/*.jar" />
				</fileset>
				<pathelement location="saferefactor.jar" />
				<pathelement path="${java.class.path}" />
				<pathelement location="${source}/${bin}" />
				<pathelement location="${source}/bin" />
			</classpath>
			<classpath refid="classpath_source" />
			<formatter type="xml" />
			<batchtest todir="${junit.output}" haltonfailure="no">
				<fileset dir="${randoop.test.bin}">
					<include name="**/*.class" />
					<exclude name="**/RandoopTest.class" />
				</fileset>
			</batchtest>
		</junit>
    </target>

</project>
